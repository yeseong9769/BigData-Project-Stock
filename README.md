# 감정분석을 이용한 뉴스와 주가의 관계 분석
## How to use

## 주제 선정
평소에 주식에 대한 관심이 많았다. 그러던 도중 사람들이 뉴스 기사가 주가에 영향을 미치기 때문에 기업이나 외인이 시세 조정에 이용한다는 주장을 보게 되었다. 그래서 실제로 뉴스가 주가에 미치는 영향이 있는지 궁금해졌다.

## 순서
분석은 다음과 같은 순서로 진행했다.
1. 데이터 수집
2. 뉴스 기사 제목 별 감정 분석
3. 뉴스와 주가간의 상관성 분석

### 1. 데이터 수집
#### 1.1 뉴스 데이터 수집
뉴스 데이터 수집은 네이버페이 증권의 종목별 뉴스를 이용했다. 네이버 공식 API를 이용할 수도 있었지만 필요없는 내용을 제외하고 증권 뉴스만 가져오기 위해서 네이버페이 증권 뉴스를 이용했다.

![image](https://github.com/yeseong9769/BigData-Project-Stock/assets/36146823/9b7d896e-b17f-4331-8525-80fe4ec7e02e)


여기서 크롤링을 진행하면서 문제가 하나 발생했는데 일정 날짜가 넘어가게 되면 페이지 번호가 달라져도 보여지는 뉴스가 똑같다는 것이였다. 

![image](https://github.com/yeseong9769/BigData-Project-Stock/assets/36146823/e3adcf1b-9d16-4ac6-8d3b-ff91e9ac93a1)


이 부분은 네이버 증권 뉴스 자체의 문제였기 때문에 해결하지 못했고 결국에 가져올 수 있는 데이터 범위가 제한되게 되었다. 그래서 이번 분석에서는 데이터 수집 범위를 2023년 09월 21일 이후로 제한할 수 밖에 없었다.

그리고 네이버 증권 뉴스에는 관련 뉴스도 제공해서 겹치는 뉴스를 제외하기 위해서 <tr> 태그를 가져올 때 필터링 하기 위해서 아래와 같은 필터링을 수행했다.

![image](https://github.com/yeseong9769/BigData-Project-Stock/assets/36146823/c323e464-bf1f-4f49-8bf4-9f4a68559456)


### 2. 뉴스 기사 감정 분석
#### 2.2 증권 주식 데이터 수집
증권 데이터 수집은 Yahoo Finance에서 제공하는 yfinace 파이썬 라이브러리를 사용하였다. 증권 데이터도 뉴스 데이터와 동일하게 2023년 09월 21일 이후로 데이터 수집 범위를 정했다.
![제목 없음](https://github.com/yeseong9769/BigData-Project-Stock/assets/36146823/ee41cb12-5967-4e9d-891f-5022d7973e07)

#### 2.2 뉴스 기사 제목 별 감정 분석
금융 뉴스 기사의 감정을 분석하기 위해서 서울대학교 서울대학교 컴퓨터언어학_자연어처리 연구실에서 개발한 KR-FinBert-SC 금융 뉴스 분석 모델(https://huggingface.co/snunlp/KR-FinBert-SC) 을 사용하였다. 이 모델을 사용하게 된 이유는 먼저 뉴스 기사를 분석하는데 금융 분야에 특화된 모델이 필요했고, 두번째로 기존의 금융 뉴스 분석 모델을 있었지만 한국어 지원은 되지 않았기에 앞서 선택한 모델을 사용하게 되었다.

![image](https://github.com/yeseong9769/BigData-Project-Stock/assets/36146823/f474977b-6465-4ecc-bba7-f65580697b34)

이후에 positive, netural, negative로 구분된 감점을 분석하기 위해 계량화 작업을 진행하였다. 계량화 한 날짜별 감정 분포도는 아래와 같이 나타났다.

![제목 없음](https://github.com/yeseong9769/BigData-Project-Stock/assets/36146823/65d5bb02-3055-484d-87c9-98ac3f20c5b0)

### 3. 뉴스와 주가간의 상관성 분석
뉴스 데이터와 주식 데이터간의 상관관계 분석을 위해 다음과 같은 단계를 거쳤다.
1. 두 데이터들의 Date열을 datetime 형식으로 변환하고 두 datetime 형식을 같은 형식으로 맞춘다음 합친다.
2. 주가 데이터를 log변환한후 차분하고 감정 점수와 같이 min-max-scailing 방식으로 정규화 한뒤 0.5를 빼서 음과 양을 표현할 수 있도록 했다.
3. 상관분표 표를 통해 일별, 주별 감성 점수와 주식 데이터간의 상관관계를 나타냈다.

아래의 표는 뉴스 기사에 대한 감성 점수와 각 기간(주, 일) 별 주가의 피어슨 상관 검정 결괏값을 나타낸 것이다. r은 상관계수, p는 p-value를 의미한다.​<br>
**분석한 결과를 봤을 때, 주별로는 0.7의 상관관계를 일별로는 0.45의 상관관계를 나타냈다.** 상관계수는 보통 -1 ~ 1 사이의 범위를 가진다.<br>
이 결과에서는 주별로는 봤을때는 상관관계가 높지는 않았지만, 일별로는 어느정도의 상관관계가 있는 것으로 보인다.<br>

![제목 없음](https://github.com/yeseong9769/BigData-Project-Stock/assets/36146823/7d129c5f-a59a-48ba-8479-3fe035c9700c)

### 4. 결론
결과적으로 이번 분석에서는 뉴스와 주가간의 상관관계는 어느정도 있는 것으로 보인다.<br>
그러나 일단 수집할 수 있었던 데이터의 범위가 제한적이였기 때문에 좀 더 과거에도 상관관계가 있었을지 아니면 미래에도 상관관계가 있을지는 미지수이다.<br>
또 아쉬운 점으로, 장 마감 후에 나온 뉴스 기사는 당일 주가에는 영향을 미치지 못하지만 그 다음날의 주가에는 영향을 미칠 수 있기 때문에 이런 것들을 고려해서 시간별로 세분화 해서 분석할 수 있었다면 좀 더 좋은 결과가 나오지 않았을까 생각한다.<br>

### Reference
김유신, 김남규, 정승렬. (2012). 뉴스와 주가 : 빅데이터 감성분석을 통한 지능형 투자의사결정모형. 지능정보연구, 18(2), 143-156.

이예지. "뉴스 빅데이터 분석을 통한 종목별 주가예측." 국내석사학위논문 충북대학교, 2014. 충청북도

https://songseungwon.tistory.com/124

https://github.com/CSJ516/Stock_Prediction_project

https://github.com/seyoongit/news

https://github.com/park-gb/financial-news-sentiment-classifier/blob/main/sentiment_classifier.ipynb
